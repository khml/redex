# 0025 複数行の処理対応（改行必須）

## 概要
現在、この言語処理系は単一行（1行）しか処理できません。入力を複数行で受け取り、各行を順次評価できるように対応します。行は必ず改行（"\n"）で終わるものとします。

## 目的
- 複数行のソースを受け付け、各行を独立した文（statement）として順次評価する。
- 既存の単一行動作を破壊しない。

## 要件
- 入力は複数行を許容する（各行は末尾に改行を持つことを前提）。
- 空行は無視する（コメント行や空白のみの行は評価対象外）。
- 最終行も必ず改行があることを前提にする。改行がない入力はエラーにするか、明確に動作を定義する（実装案ではエラーとする）。
- 評価の順序は上から下へ行ごとに実行する。
- 既存の単一行インターフェース（API/CLI/テスト）は互換性を保つ。

## 受け入れ基準
- `spec/` に複数行入力を使ったRSpecテストが追加され、成功すること。
- `lib/redex/tokenizer.rb`, `lib/redex/parser.rb`, `lib/redex/evaluator.rb` の変更点は最小限で、既存テストが破壊されないこと。
- 空行を含む複数行のソースを与えたとき、空行は無視され期待どおりに実行されること。
- 改行のない終端を持つ入力に対してはエラーが返る（または仕様通りの動作をドキュメント化する）。

## 実装タスク（案）
1. トークナイザ：改行を文区切りとして認識する処理を追加（`\n` を分割トークン、またはトークンの境界として扱う）。
2. パーサ：複数の文をパースしてASTのリスト（またはシーケンス）を返せるようにする。
3. 評価器：ASTのシーケンスを順次評価し、最終的な結果の扱い（最後の式の値を返す、または副作用で十分）を明確化して実装する。
4. テスト：`spec/interpreter_spec.rb` 等に複数行ケース、空行ケース、末尾改行欠如のエラーケースを追加。
5. ドキュメント：`README.md` と `docs/` の該当箇所に挙動を記載。
	- クラス設計やEBNF等の関連設計ドキュメント（`docs/architecture.md`, `docs/parser.md`, `docs/tokenizer.rb`, `docs/ebnf.md` 等）も合わせて更新する。
6. PR作成：実装ブランチを作成し、変更点と移行手順を含むPRを作成する。

## テスト観点
- 単純な複数行（例: `a = 1\nb = 2\na + b\n`）が期待値を返すこと。
- 空行やコメント行を含む場合、評価に影響しないこと。
- 改行無しの入力はエラー（または明記された挙動）になること。
- 既存の単一行テストが通ること。

## 見積もり
- 実装 + テスト + ドキュメント：概ね2〜4時間（既存コードの構造次第で前後）。

## 備考・実装上の注意
- 既存APIや外部インターフェース（`bin/console` 等）との互換性を優先する。
- 大きな設計変更が必要な場合は別チケット（分割）として扱う。

作業開始前に方針に同意いただければ、まずはトークナイザ/パーサの最小変更でプロトタイプを作成します。