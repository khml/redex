<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="900" height="360" viewBox="0 0 900 360">
  <style> .box { fill:#f5f7ff; stroke:#334155; stroke-width:2; } .text { font-family: Arial, Helvetica, sans-serif; font-size:14px; fill:#0f172a; }</style>
  <!-- tokenizer -->
  <rect x="20" y="40" width="200" height="80" rx="8" class="box" />
  <text x="40" y="80" class="text">tokenizer</text>
  <text x="40" y="100" class="text">ソース → トークン</text>

  <!-- parser -->
  <rect x="260" y="40" width="200" height="80" rx="8" class="box" />
  <text x="280" y="80" class="text">parser</text>
  <text x="280" y="100" class="text">トークン → AST</text>

  <!-- evaluator -->
  <rect x="500" y="40" width="320" height="120" rx="8" class="box" />
  <text x="520" y="70" class="text">evaluator</text>
  <text x="520" y="90" class="text">AST + context → result, env</text>
  <text x="520" y="110" class="text">errors, provenance, meta (optional)</text>

  <!-- resolver -->
  <rect x="500" y="180" width="220" height="80" rx="8" class="box" />
  <text x="520" y="210" class="text">resolver</text>
  <text x="520" y="230" class="text">ruby_resolver / context 統合</text>

  <!-- errors -->
  <rect x="740" y="180" width="80" height="80" rx="8" class="box" />
  <text x="750" y="215" class="text">errors</text>

  <!-- arrows -->
  <line x1="220" y1="80" x2="260" y2="80" stroke="#0f172a" stroke-width="2" marker-end="url(#arrow)" />
  <line x1="460" y1="80" x2="500" y2="80" stroke="#0f172a" stroke-width="2" marker-end="url(#arrow)" />
  <line x1="640" y1="140" x2="640" y2="180" stroke="#0f172a" stroke-width="2" marker-end="url(#arrow)" />
  <line x1="720" y1="220" x2="740" y2="220" stroke="#0f172a" stroke-width="2" marker-end="url(#arrow)" />

  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="8" refY="5" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L10,5 L0,10 z" fill="#0f172a" />
    </marker>
  </defs>

  <!-- legend -->
  <text x="20" y="320" class="text">注: resolver は評価時に参照され、`context` と `ruby_resolver` により識別子を解決します。</text>
</svg>
